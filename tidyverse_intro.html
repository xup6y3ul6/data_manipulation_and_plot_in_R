<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Data Manipulation and Plot in R</title>
    <meta charset="utf-8" />
    <meta name="author" content="林子堯 楊昊紘" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
    <script src="libs/jquery-1.12.4/jquery.min.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.5/datatables.js"></script>
    <link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="my-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Data Manipulation and Plot in R
## dplyr, tidyr and ggplot2
### 林子堯 楊昊紘
### 2020/03/28 Sat.

---




# Download: &lt;https://bit.ly/39a7RCI&gt;

.center[
![](figure/qr.ioi.tw.png)
]


```r
# install.packages(tidyverse)
library(tidyverse) # including dplyr, tidyr, &amp; ggplot ...
```

---

# Outline

.Large[
- introduction
- data.frame
- dplyr
- tidyr
- ggplot2
]


---

# Motivation

Data preprocessing takes 50-80% of your time in data analysis

Goal of Data Preprocessing  
- Make data suitable to use with a particular piece of software (i.e. R, Python)  
- Reveal important information  
- Extract variables to analyze

---

# Hadley Wickham

- The Man Who Revolutionized R
- The Committee of Presidents of Statistical Societies Awards
- [tidyverse](https://www.tidyverse.org/)

![:scale 90%](figure/HadleyWickham-R.jpg)

---

.center[
![](figure/ChartHadley.png)
]

---

.center[
![](figure/package download.png)
]

---

# R packages for data science

.center[
![:scale 90%](figure/tidyverse_data_science.png)
]

---
class: inverse, center, middle

# data.frame


---

# data.frame(): create


```r
student &lt;- data.frame(
  ID = LETTERS[1:12], 
  math = round(rnorm(12, 50, 15), 1),
  chinese = seq(4, 92, length.out = 12))
student
```

```
   ID math chinese
1   A 74.2       4
2   B 54.0      12
3   C 48.9      20
4   D 52.5      28
5   E 72.3      36
6   F 35.5      44
7   G 38.6      52
8   H 27.5      60
9   I 21.5      68
10  J 60.1      76
11  K 38.8      84
12  L 32.4      92
```

--- 

# data.frame(): create

load data

```r
ebg001 &lt;- read.csv("data/001_b_1110_1_1_p1.csv", 
                   fileEncoding = "UTF-8")
head(ebg001)
```

```
  Trials MarketCondition StockPrice p1Cash p1Stock p1TotalAsset p1Decision
1      1               1        100  10000      10        11000        buy
2      2               1        105   9900      11        11055       sell
3      3               1        105  10005      10        11055        buy
4      4               1        111   9900      11        11121       sell
5      5               1        106  10011      10        11071   no trade
6      6               1        103  10011      10        11041        buy
  p1ChechHistory
1             no
2             no
3            yes
4             no
5            yes
6            yes
```

```r
class(ebg001)
```

```
[1] "data.frame"
```

---

# data.frame(): read


```r
# []
ebg[1]
ebg["p1Cash"]

# [,]
ebg[1, 3]
ebg[1:10, 2:3]

# [[]]
ebg[[1]]

# $
ebg$StockPrice
ebg$p1Decision[61:100]
typeof(ebg)
```

---

# data.frame(): update


```r
student$psychology &lt;- rep(c(59, 61), each = 2, times = 3)
student
```

```
   ID math chinese psychology
1   A 74.2       4         59
2   B 54.0      12         59
3   C 48.9      20         61
4   D 52.5      28         61
5   E 72.3      36         59
6   F 35.5      44         59
7   G 38.6      52         61
8   H 27.5      60         61
9   I 21.5      68         59
10  J 60.1      76         59
11  K 38.8      84         61
12  L 32.4      92         61
```


---
class: inverse, center, middle

# dplyr

---

# tibble


```r
# install.packages("nycflights13")
data(flights, package = "nycflights13")
flights
```

```
# A tibble: 336,776 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
 1  2013     1     1      517            515         2      830
 2  2013     1     1      533            529         4      850
 3  2013     1     1      542            540         2      923
 4  2013     1     1      544            545        -1     1004
 5  2013     1     1      554            600        -6      812
 6  2013     1     1      554            558        -4      740
 7  2013     1     1      555            600        -5      913
 8  2013     1     1      557            600        -3      709
 9  2013     1     1      557            600        -3      838
10  2013     1     1      558            600        -2      753
# … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
#   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
#   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

# select()


```r
flight1 &lt;- select(flights, month:day, tailnum, 
                  arr_delay, dep_delay, distance, air_time)
flight1
```

```
# A tibble: 336,776 x 7
   month   day tailnum arr_delay dep_delay distance air_time
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1     1     1 N14228         11         2     1400      227
 2     1     1 N24211         20         4     1416      227
 3     1     1 N619AA         33         2     1089      160
 4     1     1 N804JB        -18        -1     1576      183
 5     1     1 N668DN        -25        -6      762      116
 6     1     1 N39463         12        -4      719      150
 7     1     1 N516JB         19        -5     1065      158
 8     1     1 N829AS        -14        -3      229       53
 9     1     1 N593JB         -8        -3      944      140
10     1     1 N3ALAA          8        -2      733      138
# … with 336,766 more rows
```

---

# filter()


```r
filter(flight1, month == 5, 
       day %in% c(1, 2, 3), arr_delay &gt; 0)
```

```
# A tibble: 844 x 7
   month   day tailnum arr_delay dep_delay distance air_time
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1     5     1 N628VA        408       434     2475      341
 2     5     1 N196UW          1        -9      529       94
 3     5     1 N174AT          2        -1      762      113
 4     5     1 N751UW          7       -10      541       88
 5     5     1 N359NB          4        -8      746      114
 6     5     1 N564UW          6        -6      529       83
 7     5     1 N482UA         13         0     1416      197
 8     5     1 N13550         27         9      416       72
 9     5     1 N539UW          2        -6      529       84
10     5     1 N750UW          3        -5      214       36
# … with 834 more rows
```

---

# sample_n() and sample_frac()


```r
sample_n(flight1, 4) # fixed number
```

```
# A tibble: 4 x 7
  month   day tailnum arr_delay dep_delay distance air_time
  &lt;int&gt; &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1     1    25 N13914         68        49      533      104
2     2    28 N849UA         -6        -4      937      145
3    10    14 N528MQ         10         0      431       72
4     6    17 N371DA         92        57      760      106
```

```r
sample_frac(flight1, 0.00001) # fixed fraction
```

```
# A tibble: 3 x 7
  month   day tailnum arr_delay dep_delay distance air_time
  &lt;int&gt; &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1     6    25 &lt;NA&gt;           NA        NA       94       NA
2     1    19 N320AA        -20         5     2475      332
3     9    18 N650AW         -3         6      529       81
```

---

# arrange()


```r
arrange(flight1, distance)
```

```
# A tibble: 336,776 x 7
   month   day tailnum arr_delay dep_delay distance air_time
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1     7    27 &lt;NA&gt;           NA        NA       17       NA
 2     1     3 N13989         -2        -2       80       30
 3     1     4 N14972         27        40       80       30
 4     1     4 N15983        136       134       80       28
 5     1     4 N27962         -6        -1       80       32
 6     1     5 N14902        -25        -5       80       29
 7     1     6 N22909          0        -4       80       22
 8     1     7 N33182        -12        -5       80       25
 9     1     8 N11194         39        -3       80       30
10     1     9 N17560         -7        -3       80       27
# … with 336,766 more rows
```

---

# arrange(desc())


```r
arrange(flight1, desc(month), desc(day))
```

```
# A tibble: 336,776 x 7
   month   day tailnum arr_delay dep_delay distance air_time
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1    12    31 N566JB          2        14     1576      189
 2    12    31 N713TW          5        19     1598      192
 3    12    31 N374JB         96       101      273       50
 4    12    31 N557UW          4        -1      529       95
 5    12    31 N470UA          2        -1     1400      223
 6    12    31 N577UA         25        -2     2454      346
 7    12    31 N3CXAA        -20       -10      733      127
 8    12    31 N14916        -15        -8      645      118
 9    12    31 N333NB        -13        -7      502       86
10    12    31 N552JB         -3         4     1576      195
# … with 336,766 more rows
```

---

# mutate()


```r
mutate(flight1,
       gain = arr_delay - dep_delay,
       speed = distance / air_time * 60)
```

```
# A tibble: 336,776 x 9
   month   day tailnum arr_delay dep_delay distance air_time  gain speed
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1     1 N14228         11         2     1400      227     9  370.
 2     1     1 N24211         20         4     1416      227    16  374.
 3     1     1 N619AA         33         2     1089      160    31  408.
 4     1     1 N804JB        -18        -1     1576      183   -17  517.
 5     1     1 N668DN        -25        -6      762      116   -19  394.
 6     1     1 N39463         12        -4      719      150    16  288.
 7     1     1 N516JB         19        -5     1065      158    24  404.
 8     1     1 N829AS        -14        -3      229       53   -11  259.
 9     1     1 N593JB         -8        -3      944      140    -5  405.
10     1     1 N3ALAA          8        -2      733      138    10  319.
# … with 336,766 more rows
```

---

# select(mutate())



```r
select(
  mutate(flight1, 
         gain = arr_delay - dep_delay, 
         speed = distance / air_time * 60
  ),
  gain, speed
)
```

```
# A tibble: 336,776 x 2
    gain speed
   &lt;dbl&gt; &lt;dbl&gt;
 1     9  370.
 2    16  374.
 3    31  408.
 4   -17  517.
 5   -19  394.
 6    16  288.
 7    24  404.
 8   -11  259.
 9    -5  405.
10    10  319.
# … with 336,766 more rows
```

---

# transmute() == select(mutate())


```r
transmute(flight1, 
          gain = arr_delay - dep_delay,
          speed = distance / air_time * 60)
```

```
# A tibble: 336,776 x 2
    gain speed
   &lt;dbl&gt; &lt;dbl&gt;
 1     9  370.
 2    16  374.
 3    31  408.
 4   -17  517.
 5   -19  394.
 6    16  288.
 7    24  404.
 8   -11  259.
 9    -5  405.
10    10  319.
# … with 336,766 more rows
```

---

# nested structure 

It is very hard to read ...


```r
filter(
  summarise(
    select(
      group_by(flight1, month, day),
      arr_delay, dep_delay
    ),
    arr = mean(arr_delay, na.rm = TRUE),
    dep = mean(dep_delay, na.rm = TRUE)
  ),
  arr &gt; 30 | dep &gt; 30
)
```


---

# pipe operator %&gt;%


```r
flight1 %&gt;% 
  mutate(gain = arr_delay - dep_delay, 
         speed = distance / air_time * 60) %&gt;% 
  select(gain, speed)
```

```
# A tibble: 336,776 x 2
    gain speed
   &lt;dbl&gt; &lt;dbl&gt;
 1     9  370.
 2    16  374.
 3    31  408.
 4   -17  517.
 5   -19  394.
 6    16  288.
 7    24  404.
 8   -11  259.
 9    -5  405.
10    10  319.
# … with 336,766 more rows
```

---

# summarise()


```r
flight1 %&gt;% 
  summarise(delay_mean = mean(dep_delay, na.rm = TRUE), 
            delay_sd = sd(dep_delay, na.rm = TRUE))
```

```
# A tibble: 1 x 2
  delay_mean delay_sd
       &lt;dbl&gt;    &lt;dbl&gt;
1       12.6     40.2
```

---

# group_by() %&gt;% summarise()


```r
flight1 %&gt;%
  group_by(month) %&gt;% 
  summarise(delay_mean = mean(dep_delay, na.rm = TRUE), 
            delay_sd = sd(dep_delay, na.rm = TRUE))
```

```
# A tibble: 12 x 3
   month delay_mean delay_sd
   &lt;int&gt;      &lt;dbl&gt;    &lt;dbl&gt;
 1     1      10.0      36.4
 2     2      10.8      36.3
 3     3      13.2      40.1
 4     4      13.9      43.0
 5     5      13.0      39.4
 6     6      20.8      51.5
 7     7      21.7      51.6
 8     8      12.6      37.7
 9     9       6.72     35.6
10    10       6.24     29.7
11    11       5.44     27.6
12    12      16.6      41.9
```


---

# left_join()

.pull-left[

```r
flights2 &lt;- flights %&gt;% 
  select(month:day, tailnum, carrier) 
flights2 %&gt;% head()
```

```
# A tibble: 6 x 4
  month   day tailnum carrier
  &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  
1     1     1 N14228  UA     
2     1     1 N24211  UA     
3     1     1 N619AA  AA     
4     1     1 N804JB  B6     
5     1     1 N668DN  DL     
6     1     1 N39463  UA     
```
]

.pull-right[

```r
data(airlines, package = "nycflights13")
airlines %&gt;% head()
```

```
# A tibble: 6 x 2
  carrier name                    
  &lt;chr&gt;   &lt;chr&gt;                   
1 9E      Endeavor Air Inc.       
2 AA      American Airlines Inc.  
3 AS      Alaska Airlines Inc.    
4 B6      JetBlue Airways         
5 DL      Delta Air Lines Inc.    
6 EV      ExpressJet Airlines Inc.
```
]

---

# left_join()


```r
flights2 %&gt;% 
  left_join(airlines)
```

```
Joining, by = "carrier"
```

```
# A tibble: 336,776 x 5
   month   day tailnum carrier name                    
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                   
 1     1     1 N14228  UA      United Air Lines Inc.   
 2     1     1 N24211  UA      United Air Lines Inc.   
 3     1     1 N619AA  AA      American Airlines Inc.  
 4     1     1 N804JB  B6      JetBlue Airways         
 5     1     1 N668DN  DL      Delta Air Lines Inc.    
 6     1     1 N39463  UA      United Air Lines Inc.   
 7     1     1 N516JB  B6      JetBlue Airways         
 8     1     1 N829AS  EV      ExpressJet Airlines Inc.
 9     1     1 N593JB  B6      JetBlue Airways         
10     1     1 N3ALAA  AA      American Airlines Inc.  
# … with 336,766 more rows
```

---

# left_join

.pull-left[

```r
(df1 &lt;- tibble(x = c(1, 2), 
               y = 2:1))
```

```
# A tibble: 2 x 2
      x     y
  &lt;dbl&gt; &lt;int&gt;
1     1     2
2     2     1
```
]

.pull-right[

```r
(df2 &lt;- tibble(x = c(1, 3), 
  a = 10, b = "HI"))
```

```
# A tibble: 2 x 3
      x     a b    
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
1     1    10 HI   
2     3    10 HI   
```
]

--


```r
df1 %&gt;% left_join(df2)
```

```
Joining, by = "x"
```

```
# A tibble: 2 x 4
      x     y     a b    
  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
1     1     2    10 HI   
2     2     1    NA &lt;NA&gt; 
```

---

# right_join()

.pull-left[

```r
(df1 &lt;- tibble(x = c(1, 2), 
               y = 2:1))
```

```
# A tibble: 2 x 2
      x     y
  &lt;dbl&gt; &lt;int&gt;
1     1     2
2     2     1
```
]

.pull-right[

```r
(df2 &lt;- tibble(x = c(1, 3), 
  a = 10, b = "HI"))
```

```
# A tibble: 2 x 3
      x     a b    
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
1     1    10 HI   
2     3    10 HI   
```
]

--


```r
df1 %&gt;% right_join(df2)
```

```
Joining, by = "x"
```

```
# A tibble: 2 x 4
      x     y     a b    
  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
1     1     2    10 HI   
2     3    NA    10 HI   
```

---

# inner_join()

.pull-left[

```r
(df1 &lt;- tibble(x = c(1, 2), 
               y = 2:1))
```

```
# A tibble: 2 x 2
      x     y
  &lt;dbl&gt; &lt;int&gt;
1     1     2
2     2     1
```
]

.pull-right[

```r
(df2 &lt;- tibble(x = c(1, 3), 
  a = 10, b = "HI"))
```

```
# A tibble: 2 x 3
      x     a b    
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
1     1    10 HI   
2     3    10 HI   
```
]

--


```r
df1 %&gt;% inner_join(df2)
```

```
Joining, by = "x"
```

```
# A tibble: 1 x 4
      x     y     a b    
  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
1     1     2    10 HI   
```

---

# Practice 1

試著將同一組的 player 1 和 player 2 這兩筆資料給合併在同一個表格

--


```r
ebg002 &lt;- read.csv("data/002_b_1110_1_1_p2.csv", 
                   fileEncoding = "UTF-8")
ebg_g1 &lt;- ebg001 %&gt;% 
  left_join(ebg002) 
```

```
Joining, by = c("Trials", "MarketCondition", "StockPrice")
```

---

# Practice 1

試著將同一組的 player 1 和 player 2 這兩筆資料給合併在同一個表格


```r
DT::datatable(ebg_g1)
```

<div id="htmlwidget-3476a954ed6ca31818a2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3476a954ed6ca31818a2">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[100,105,105,111,106,103,103,103,100,105,100,100,97,102,97,100,97,97,97,93,96,96,92,102,97,95,105,100,97,107,104,99,97,97,97,107,107,114,121,118,126,123,120,128,125,133,141,156,149,149,149,145,145,138,138,134,130,138,138,132,132,126,130,134,141,127,131,138,138,143,148,153,158,163,155,148,141,134,139,133,127,121,115,110,105,100,95,95,95,98,94,90,86,82,78,75,72,69,66,66,68],[10000,9900,10005,9900,10011,10011,9908,9805,9805,9705,9810,9710,9710,9613,9715,9715,9715,9618,9521,9618,9618,9714,9810,9718,9820,9820,9725,9830,9830,9733,9733,9837,9837,9934,9837,9740,9633,9526,9412,9533,9415,9541,9664,9544,9672,9547,9414,9273,9429,9578,9727,9876,10021,10166,10166,10166,10166,10036,10174,10312,10312,10444,10318,10188,10054,10195,10068,9937,9799,9661,9518,9370,9217,9059,9222,9377,9525,9666,9532,9671,9804,9931,10052,10167,10277,10382,10482,10482,10482,10387,10485,10579,10669,10755,10837,10915,10990,11062,11131,11131,11131],[10,11,10,11,10,10,11,12,12,13,12,13,13,14,13,13,13,14,15,14,14,13,12,13,12,12,13,12,12,13,13,12,12,11,12,13,14,15,16,15,16,15,14,15,14,15,16,17,16,15,14,13,12,11,11,11,11,12,11,10,10,9,10,11,12,11,12,13,14,15,16,17,18,19,18,17,16,15,16,15,14,13,12,11,10,9,8,8,8,9,8,7,6,5,4,3,2,1,0,0,0],[11000,11055,11055,11121,11071,11041,11041,11041,11005,11070,11010,11010,10971,11041,10976,11015,10976,10976,10976,10920,10962,10962,10914,11044,10984,10960,11090,11030,10994,11124,11085,11025,11001,11001,11001,11131,11131,11236,11348,11303,11431,11386,11344,11464,11422,11542,11670,11925,11813,11813,11813,11761,11761,11684,11684,11640,11596,11692,11692,11632,11632,11578,11618,11662,11746,11592,11640,11731,11731,11806,11886,11971,12061,12156,12012,11893,11781,11676,11756,11666,11582,11504,11432,11377,11327,11282,11242,11242,11242,11269,11237,11209,11185,11165,11149,11140,11134,11131,11131,11131,11131],["buy","sell","buy","sell","no trade","buy","buy","no trade","buy","sell","buy","no trade","buy","sell","no trade","no trade","buy","buy","sell","no trade","sell","sell","buy","sell","no trade","buy","sell","no trade","buy","no trade","sell","no trade","sell","buy","buy","buy","buy","buy","sell","buy","sell","sell","buy","sell","buy","buy","buy","sell","sell","sell","sell","sell","sell","no trade","no trade","no trade","buy","sell","sell","no trade","sell","buy","buy","buy","sell","buy","buy","buy","buy","buy","buy","buy","buy","sell","sell","sell","sell","buy","sell","sell","sell","sell","sell","sell","sell","sell","no trade","no trade","buy","sell","sell","sell","sell","sell","sell","sell","sell","sell","no trade","no trade",""],["no","no","yes","no","yes","yes","no","no","yes","yes","no","yes","yes","yes","yes","yes","no","yes","yes","yes","yes","yes","yes","yes","yes","no","yes","yes","yes","yes","yes","yes","yes","no","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","no","no","yes","yes","no","no","yes","yes","no","yes","yes","yes","yes","no","yes","no","no","yes","yes","yes",""],[10000,9900,9795,9690,9801,9907,10010,10113,10216,10116,10221,10321,10421,10324,10426,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[10,11,12,13,12,11,10,9,8,9,8,7,6,7,6,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[11000,11055,11055,11133,11073,11040,11040,11040,11016,11061,11021,11021,11003,11038,11008,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["buy","buy","buy","sell","sell","sell","sell","sell","buy","sell","sell","sell","buy","sell","buy",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["yes","yes","yes","yes","yes","no","yes","yes","yes","yes","no","yes","yes","yes","yes",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Trials<\/th>\n      <th>MarketCondition<\/th>\n      <th>StockPrice<\/th>\n      <th>p1Cash<\/th>\n      <th>p1Stock<\/th>\n      <th>p1TotalAsset<\/th>\n      <th>p1Decision<\/th>\n      <th>p1ChechHistory<\/th>\n      <th>p2Cash<\/th>\n      <th>p2Stock<\/th>\n      <th>p2TotalAsset<\/th>\n      <th>p2Decision<\/th>\n      <th>p2ChechHistory<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,9,10,11]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

---
class: inverse, center, middle

# tidyr

---

# long vs. wide table

![:scale 90%](figure/long-wide table.jpg)

---

# wide table


```r
student
```

```
   ID math chinese psychology
1   A 74.2       4         59
2   B 54.0      12         59
3   C 48.9      20         61
4   D 52.5      28         61
5   E 72.3      36         59
6   F 35.5      44         59
7   G 38.6      52         61
8   H 27.5      60         61
9   I 21.5      68         59
10  J 60.1      76         59
11  K 38.8      84         61
12  L 32.4      92         61
```

---

# pivot_longer()


```r
student_long &lt;- pivot_longer(student, 
  cols = c("math", "chinese", "psychology"), # -ID 
  names_to = "subjects", values_to = "score")
student_long
```

```
# A tibble: 36 x 3
   ID    subjects   score
   &lt;fct&gt; &lt;chr&gt;      &lt;dbl&gt;
 1 A     math        74.2
 2 A     chinese      4  
 3 A     psychology  59  
 4 B     math        54  
 5 B     chinese     12  
 6 B     psychology  59  
 7 C     math        48.9
 8 C     chinese     20  
 9 C     psychology  61  
10 D     math        52.5
# … with 26 more rows
```

---

# pivot_wider()


```r
student_wide &lt;- pivot_wider(student_long,
  names_from = "subjects", values_from = "score")
student_wide
```

```
# A tibble: 12 x 4
   ID     math chinese psychology
   &lt;fct&gt; &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
 1 A      74.2       4         59
 2 B      54        12         59
 3 C      48.9      20         61
 4 D      52.5      28         61
 5 E      72.3      36         59
 6 F      35.5      44         59
 7 G      38.6      52         61
 8 H      27.5      60         61
 9 I      21.5      68         59
10 J      60.1      76         59
11 K      38.8      84         61
12 L      32.4      92         61
```

---

# Practice

試著把剛剛同組的 `ebg` 資料，利用 `boxplot(y~group, data)`，依照不同「資產類型」(Cash, Stock, Asset)，畫出它分佈。

--


```r
ebg_long &lt;- ebg_g1 %&gt;% 
    pivot_longer(
      cols = c("p1Cash":"p1TotalAsset", "p2Cash":"p2TotalAsset"),
      names_to = "money", values_to = "value")
boxplot(value ~ money, data = ebg_long)
```

![](tidyverse_intro_files/figure-html/unnamed-chunk-36-1.png)&lt;!-- --&gt;

---

# [Cheetsheet](https://www.rstudio.org/links/data_transformation_cheat_sheet)

![](figure/data-transformation.jpg)

---

# [Cheetsheet](https://www.rstudio.org/links/data_transformation_cheat_sheet)


![](figure/data-transformation 2.jpg)

---

# RStudio cheetsheets 

Link: &lt;https://rstudio.com/resources/cheatsheets/&gt;

In RStudio: Help &gt; Cheetsheets &gt; ...

---
class: inverse, center, middle

# ggplot2

---

---
---
---
---
---
# References

- `vignette("dplyr", package = "dplyr")`
- `vignette("", package = "dplyr")`
- ``
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="macros.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
